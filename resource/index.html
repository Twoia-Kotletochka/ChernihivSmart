<!DOCTYPE html>
<html>

<head>
  <title>Firebase ChSmart</title>
</head>

<body>
  <style>
    .container {
      display: flex;
      padding-bottom: 20px;
    }

    .column {
      border-right: 0px solid black;
    }

    .data {
      display: flex;
      flex-direction: row;
    }

    .dat {
      width: 40px;
    }

    #newsList {
      padding-left: 3px;
      padding-top: 0px;
      display: flex;
      flex-direction: column-reverse;
    }

    #newsList div {
      border-bottom: 1px solid black;
      border-top: 1px solid black;
      border-left: 1px solid black;
      padding-left: 5px;
      width: 300px;
    }
  </style>
  <h2>Add news</h1>
    <!--<input type="text" id="messageid">-->
    <div class="container">
      <div class="column" style="width: 10%;">
        <form>
          <input type="radio" name="choice" value="light" id="icon">
          <label for="light">light</label><br>

          <input type="radio" name="choice" value="gas" id="icon">
          <label for="gas">gas</label><br>

          <input type="radio" name="choice" value="water" id="icon">
          <label for="water">water</label><br>

          <input type="radio" name="choice" value="hot_water" id="icon">
          <label for="icon">hot water</label><br>
        </form>
      </div>

      <div class="column" style="width: 40%;">
        <label for="title">Заголовок</label><br>
        <textarea id="title" cols="30" rows="1" style="resize: both; overflow: auto;"></textarea>
        <br />
        <label for="subtext">Підтекст</label><br>
        <textarea id="subtext" cols="30" rows="1" style="resize: both; overflow: auto;"></textarea>
        <br />
        <label for="subtext_mini">Менший підтекст</label><br>
        <textarea id="subtext_mini" cols="30" rows="1" style="resize: both; overflow: auto;"></textarea>
      </div>

      <div class="column" style="width: 30%;">
        <label for="discription">Детальний опис</label><br>
        <textarea id="discription" cols="40" rows="3" style="resize: both; overflow: auto;"></textarea>
        <label for="data">дата.година:хвидина</label><br>
        <div class="data">
          <input type="number" name="day" id="day" class="dat">.
          <input type="number" name="hours" id="hours" class="dat">:
          <input type="number" name="minutes" id="minutes" class="dat">
        </div>
        <label for="datafull">Повна дата й час(строкове поле)</label><br>
        <input type="text" name="datafull" id="datefull">
      </div>
    </div>

    <button onclick="addNews()" style="width: 100px;">Додати новину</button>

    <h2>News list</h1>
      <ul id="newsList"></ul>

      <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-database.js"></script>

      <script>
        // Конфігурація Firebase
        var firebaseConfig = {
          apiKey: "AIzaSyCt57E8FwSRjKmXDFX88Vbw1XQO8S1Ks2k",
          authDomain: "chesmart-4e30c.firebaseapp.com",
          databaseURL: "https://chesmart-4e30c-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "chesmart-4e30c",
          storageBucket: "chesmart-4e30c.appspot.com",
          messagingSenderId: "1023454700500",
          appId: "1:1023454700500:web:b2c66aebbf7f7ba01a2c41",
          measurementId: "G-4QZH6ZH18E"
        };

        //Ініціалізація Firebase
        firebase.initializeApp(firebaseConfig);

        //Посилання на кореневий елемент бази даних



        var database = firebase.database();
        function addNews() {

          //id реалізувати авто додавання
          var icon = document.querySelector('input[name="choice"]:checked').value;

          var title = document.getElementById("title").value;
          var subtext = document.getElementById("subtext").value;
          var subtext_mini = document.getElementById("subtext_mini").value;

          var discription = document.getElementById("discription").value;
          var day = document.getElementById("day").value;
          var hours = document.getElementById("hours").value;
          var minutes = document.getElementById("minutes").value;

          var datefull = document.getElementById("datefull").value;
          var ref = firebase.database().ref("news");
          let num = 0
          // database.ref('news/').limitToLast(1).once('value')
          //   .then(function (snapshot) {
          //     num = Object.keys(snapshot.val())[0];
          //     lastid = parseInt(num) + 1;

          //   });
          let lastid = 0
          database.ref('news/').limitToLast(1).on('child_added', function (snapshot) {
            let num = snapshot.key; //получение ключа последней записи в таблице
            lastid = parseInt(num) + 1
          });


          var userData = {
            icon: icon,

            title: title,
            subtext: subtext,
            subtext_mini: subtext_mini,

            discription: discription,
            day: day,
            hours: hours,
            minutes: minutes,
            datefull: datefull
          };

          ref.child(lastid).set(userData);
        }


        // var dbRef = firebase.database().ref("news/");
        // dbRef.orderByChild("timestamp").limitToLast(10).on("value", function (data) {
        //   newsList.innerHTML = '';
        //   // Получение каждой записи из базы данных 
        //   data.forEach(function (childSnapshot) {
        //     var news = childSnapshot.val();
        //     var div = document.createElement("div");
        //     div.appendChild(document.createTextNode(news.icon));
        //     div.innerHTML += "<br/>"
        //     div.appendChild(document.createTextNode(news.title));
        //     div.innerHTML += "<br/>"
        //     div.appendChild(document.createTextNode(news.subtext));
        //     div.innerHTML += "<br/>"
        //     div.appendChild(document.createTextNode(news.subtext_mini));
        //     div.innerHTML += "<br/>"
        //     div.appendChild(document.createTextNode(news.discription));
        //     div.innerHTML += "<br/>"
        //     div.appendChild(document.createTextNode(news.day + news.hours + news.minutes + "(" + news.datefull + ")"));
        //     var p = document.createElement("p");

        //     newsList.appendChild(div);
        //     newsList.appendChild(p);
        //   });
        // });

        var newsList = document.getElementById("newsList");
        database.ref('news/').orderByKey().on('value', function (snapshot) {
          newsList.innerHTML = '';
          snapshot.forEach(function (childSnapshot) {
            var news = childSnapshot.val();
            var div = document.createElement("div");
            div.appendChild(document.createTextNode(news.icon));
            div.innerHTML += "<br/>"
            div.appendChild(document.createTextNode(news.title));
            div.innerHTML += "<br/>"
            div.appendChild(document.createTextNode(news.subtext));
            div.innerHTML += "<br/>"
            div.appendChild(document.createTextNode(news.subtext_mini));
            div.innerHTML += "<br/>"
            div.appendChild(document.createTextNode(news.discription));
            div.innerHTML += "<br/>"
            div.appendChild(document.createTextNode(news.day + news.hours + news.minutes + "(" + news.datefull + ")"));
            var p = document.createElement("p");

            newsList.appendChild(div);
            newsList.appendChild(p);
          });
        });
      </script>
      <!-- <div id="data"></div> -->
</body>

</html>